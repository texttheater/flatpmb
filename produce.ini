[]
prelude =
	splits = {
		'en': {'train': '{0..9}{2..9}', 'dev': '{0..4}0', 'test': '{0..9}1', 'eval': '{5..9}0'},
		'de': {'train': '{0..9}{3..9}', 'dev': '{0..9}0', 'test': '{0..9}{1..2}'},
		'it': {'train': '{0..9}{5..9}', 'dev': '{0..9}{0..1}', 'test': '{0..9}{2..4}'},
		'nl': {'train': '{0..9}{6..9}', 'dev': '{0..9}{0..1}', 'test': '{0..9}{2..5}'},
	}
default = %{f'out/{lang}/gold/{portion}.{x}' for lang in splits for portion in splits[lang] for x in ('drs.clf', 'parse.tags')} %{f'out/{lang}/{status}/train.{x}' for lang in splits for status in ('bronze', 'silver') for x in ('drs.clf', 'parse.tags')}

[/out/(?P<lang>.*?)/gold/(?P<portion>.*?)\.(?P<x>.*)/]
cond = %{lang in splits and portion in splits[lang] and x in ('parse.tags', 'drs.clf')}
deps = data/pmb-4.0.0
recipe =
	set -e
	mkdir -p $(dirname %{target})
	for part in data/pmb-4.0.0/data/%{lang}/gold/p%{splits[lang][portion]}
	do
		if [ -d "$part" ]
		then
			for doc in $part/*
			do
				cat $doc/%{lang}.%{x}
			done
		fi
	done > %{target}

[out/%{lang}/%{status}/train.%{x}]
cond = %{lang in splits and status in ('silver', 'bronze') and x in ('parse.tags', 'drs.clf')}
deps = data/pmb-4.0.0
recipe =
	set -e
	mkdir -p $(dirname %{target})
	for doc in data/pmb-4.0.0/data/%{lang}/%{status}/*/*
	do
		cat $doc/%{lang}.%{x}
	done > %{target}
